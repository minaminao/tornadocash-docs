# How Does Tornado Cash Work?

Tornado Cashの使い方を説明するチュートリアルに入る前に、プロトコルのグローバルな機能についての全体的な概要を説明します。

### Tornado Cashの機能に関するグローバルな概要

プライバシーを実現するために、Tornado Cashは**あるアドレスからトークンの入金を受け付け別のアドレスからその出金を可能にするスマートコントラクトを使用します**。それらのスマートコントラクトは預けたすべての資産をミックスするプールとして機能します。

これらのプールから完全に新しいアドレスによって資金が引き出されると、ソースと宛先の間のオンチェーンリンクが切断されます。そのため引き出された暗号資産は匿名化されます。

トークンがTornado Cashプールにある間、カストディはユーザーの手元に残ります。したがってユーザーは自分のトークンを完全にコントロールすることができます。

**従来のTornado Cashの固定額プールの場合**:

* ユーザーが資金をプールに入れる（デポジット）とプライベートノートが生成されます。このプライベートノートは、そのユーザーが後で資金にアクセスするための秘密鍵として機能します。資金を引き出すには、同じユーザーが別のアドレス（古いアドレスでも新しいアドレスでも）を使用し、この秘密鍵のおかげで資金を回収することができます。

**Tornado Cash Novaの任意の金額＆シールドされた送金が可能な新しいETHプールの場合**:

* 資金は指定されたウォレットアドレスに直接リンクされています。プライベートノートやキーは存在しません。ユーザーは適切なアドレスでプールに接続することで、資金にアクセスすることができます。
* カストディは、トークンをプールに預ける行為、または、プールに登録し他のアドレスから遮蔽された送金を受け取ることによって取得されます。

このようなプロトコルの強さは、ユーザー数とそのプールのサイズに直接リンクしています。より多くのユーザーがプールに入金すればするほど、その効果は大きくなります。しかし、プライバシーと匿名性を維持するために、ユーザーは以下のような基本的なルールを心に留めておく必要があります。

* 出金時のガス代支払いにリレイヤーを使用。
* 入金＆出金操作の間に時間が経過することを許容。
* 資産を回収するまでにいくつかトランザクションを待ち、資金を群衆とミックス。

*その他の推奨事項は*[*Tips to remain anonymous*](tips-to-remain-anonymous.md)*に記載されています。*

### zk-SNARKとハッシュ化処理の貢献度

Tornado Cashは、Zero-Knowledge Succinct Non-Interactive Argument of Knowledge（zk-SNARKとも呼ばれる）を使用して、トランザクションを検証し許可しています。

入金を処理するために、Tornado Cashはバイトのランダムな領域を生成し、[Pedersenハッシュ](https://iden3-docs.readthedocs.io/en/latest/iden3_repos/research/publications/zkproof-standards-workshop-2/pedersen-hash/pedersen.html)（zk-SNARKsフレンドリーであるため）を介してそれを計算し、次にトークンと20個のMiMCハッシュをスマートコントラクトに送ります。その後、コントラクトはそれをMerkleツリーに挿入します。

引き出し処理を行うために、同じ領域のバイトを片方の**シークレット**ともう片方の**nullifier**に分割する。nullifierはハッシュ化される。このnullifierは、スマートコントラクト＆Merkleツリーデータと照合するために、オンチェーンに送信されるパブリックインプットです。これによって、例えばdouble-spendingを回避することができるのです。

zk-SNARKにより、イニシャルコミットメントとnullifierの20個のMiMCハッシュを、情報を一切開示することなく証明することが可能です。たとえnullifierが公開されていても、ハッシュ化されたnullifierとイニシャルコミットメントを結びつける方法がないため、プライバシーが維持されます。さらに、トランザクションに関する情報がMerkleルートに存在する場合でも、正確なMerkleパスに関する情報、ひいてはトランザクションの場所は非公開に保たれます。

入金は技術的には簡単ですが、20個のMiMCハッシュの計算とMerkleツリーの更新が必要なためガス代は高くなります。一方で出金処理は複雑ですが、ガスはnullifierハッシュとゼロ知識証明にのみ必要なため安く済みます。

*Written & updated by* [*@ayefda*](https://torn.community/u/ayefda)

